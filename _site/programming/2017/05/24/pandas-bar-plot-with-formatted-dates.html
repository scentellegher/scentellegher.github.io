<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Pandas & Matplotlib: personalize the date format in a bar chart - Simone Centellegher, PhD - Data scientist and Researcher</title>

  <!-- Edit site and author settings in `_config.yml` to make the social details your own -->

    <meta content="Simone Centellegher, PhD - Data scientist and Researcher" property="og:site_name">
  
    <meta content="Pandas & Matplotlib: personalize the date format in a bar chart" property="og:title">
  
  
    <meta content="article" property="og:type">
  
  
    <meta content="Data Scientist and Researcher @ Fondazione Bruno Kessler (Italy)
" property="og:description">
  
  
    <meta content="http://localhost:4000/programming/2017/05/24/pandas-bar-plot-with-formatted-dates.html" property="og:url">
  
  
    <meta content="2017-05-24T02:00:00+02:00" property="article:published_time">
    <meta content="http://localhost:4000/about/" property="article:author">
  
  
    <meta content="http://localhost:4000/assets/img/avatar.jpg" property="og:image">
  
  
    
    <meta content="programming" property="article:section">
    
  
  
    
    <meta content="pandas" property="article:tag">
    
    <meta content="matplotlib" property="article:tag">
    
    <meta content="visualization" property="article:tag">
    
  

    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@">
    <meta name="twitter:creator" content="@simonecent">
  
    <meta name="twitter:title" content="Pandas & Matplotlib: personalize the date format in a bar chart">
  
  
    <meta name="twitter:url" content="http://localhost:4000/programming/2017/05/24/pandas-bar-plot-with-formatted-dates.html">
  
  
    <meta name="twitter:description" content="Data Scientist and Researcher @ Fondazione Bruno Kessler (Italy)
">
  
  
    <meta name="twitter:image:src" content="http://localhost:4000/assets/img/avatar.jpg">
  

	<meta name="description" content="">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="initial-scale=1, maximum-scale=1">
	<meta property="og:image" content="">
	<link rel="shortcut icon" href="/assets/img/favicon/favicon.ico" type="image/x-icon">
	<link rel="apple-touch-icon" href="/assets/img/favicon/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicon/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicon/apple-touch-icon-144x144.png">
	<!-- Chrome, Firefox OS and Opera -->
	<meta name="theme-color" content="#263959">
	<!-- Windows Phone -->
	<meta name="msapplication-navbutton-color" content="#263959">
	<!-- iOS Safari -->
	<meta name="apple-mobile-web-app-status-bar-style" content="#263959">
	<!-- Google Fonts -->
	<link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,600" rel="stylesheet">
	<!-- Font Awesome -->
	<link rel="stylesheet" href="/assets/fonts/font-awesome/css/font-awesome.min.css">
	<!-- Styles -->
	<link rel="stylesheet" href="/assets/css/main.css">
  <!-- MathJax -->
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

  <!-- Cookie banner -->
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css" />
  <!-- Site verification -->
  <meta name="google-site-verification" content="sZB103JolPNU6L9ptJEZyy-OLhykJGu3zKyjQb7FVuo" />

</head>

<body>

  <div class="wrapper">
    <aside class="sidebar">
  <header>
    <div class="about">
      <div class="cover-author-image">
        <a href="/"><img src="/assets/images/avatar.jpg" alt="Simone Centellegher"></a>
      </div>
      <div class="author-name">Simone Centellegher</div>
      <p>Data scientist and Researcher in the Mobile and Social Computing Lab @ Fondazione Bruno Kessler (Trento, Italy).  I study human behaviour from data generated by mobile phones, social media and credit card transactions.</p>
    </div>
    <div class="bmc">
      <a href='https://ko-fi.com/Y8Y2LIWPU' target='_blank'><img height='36' style='border:0px;height:36px;' src='https://storage.ko-fi.com/cdn/kofi4.png?v=3' border='0' alt='Buy Me a Coffee at ko-fi.com' /></a>
    </div>
  </header> <!-- End Header -->
  <!-- <div class="navigation">
    <ul>
      
        <li><a style='font-weight: 300;' href="/categories/research">research</a></li>
      
        <li><a style='font-weight: 300;' href="/categories/programming">programming</a></li>
      
        <li><a style='font-weight: 300;' href="/categories/visualization">visualization</a></li>
      
        <li><a style='font-weight: 300;' href="/categories/machine-learning">machine-learning</a></li>
      
    </ul>
  </div>  -->

    


  <footer>
    <section class="contact">
      <h3 class="contact-title">Contact me</h3>
      <ul>
        
          <li><a id='twitter' href="https://twitter.com/simonecent" target="_blank"><i class="fa fa-twitter" aria-hidden="true"></i></a></li>
        
        <!-- 
          <li><a href="https://facebook.com/" target="_blank"><i class="fa fa-facebook" aria-hidden="true"></i></a></li>
         -->
        
          <li class="github"><a id='github' href="http://github.com/scentellegher" target="_blank"><i class="fa fa-github"></i></a></li>
        
        
          <li class="linkedin"><a id='linkedin' href="https://in.linkedin.com/in/scentellegher" target="_blank"><i class="fa fa-linkedin"></i></a></li>
        
        <!-- 
          <li class="email"><a href="mailto:example.david@blog.com"><i class="fa fa-envelope-o" aria-hidden="true"></i></a></li>
         -->
        <li><a id='cv' href="/assets/cv/simone_centellegher_cv.pdf" target="_blank"><i class="fa fa-file-text-o"></i></a></li>
        <li class="scholar"><a id='scholar' href="https://scholar.google.it/citations?user=-W9l1PFnP6gC&hl=en" target="_blank"><i class="fa fa-google"></i></a></li>
      </ul>
    </section> <!-- End Section Contact -->
    <div class="copyright">
      <p>2023 &copy; Simone Centellegher</p>
    </div>
  </footer> <!-- End Footer -->
</aside> <!-- End Sidebar -->
<div class="content-box clearfix">
  <article class="article-page">
  <div class="page-content">
    
    
    <div class="wrap-content">
      <header class="header-page">
        <h1 class="page-title">Pandas & Matplotlib: personalize the date format in a bar chart</h1>
        <div class="page-date"><span>2017, May 24&nbsp;&nbsp;&nbsp;&nbsp;</span></div>
        <div class="share-page">
    Share this on &rarr;
    <a href="https://twitter.com/intent/tweet?text=Pandas & Matplotlib: personalize the date format in a bar chart&url=http://localhost:4000/programming/2017/05/24/pandas-bar-plot-with-formatted-dates.html&via=&related=" rel="nofollow" target="_blank" title="Share on Twitter" style="color:  #1DA1F2;">
    	<i class="fa fa-twitter fa-lg"></i>
    </a>
    <a href="https://www.facebook.com/sharer.php?u=http://localhost:4000//programming/2017/05/24/pandas-bar-plot-with-formatted-dates.html&title=Pandas & Matplotlib: personalize the date format in a bar chart" rel="nofollow" target="_blank" title="Share on Facebook" style='color: #4867AA;'>
    	<i class="fa fa-facebook fa-lg"></i>
    </a>
    <!-- <a href="https://plus.google.com/share?url=http://localhost:4000/programming/2017/05/24/pandas-bar-plot-with-formatted-dates.html" rel="nofollow" target="_blank" title="Share on Google+" style='color: #DD4B39;'>
    	<i class="fa fa-google-plus fa-lg"></i>
    </a> -->
    <a href="http://www.linkedin.com/shareArticle?mini=true&url=http://localhost:4000/programming/2017/05/24/pandas-bar-plot-with-formatted-dates.html&title=Pandas & Matplotlib: personalize the date format in a bar chart" target="_blank" title="Share on LinkedIn" style='color: #0177B5;'>
    	<i class="fa fa-linkedin fa-lg"></i>
    </a>
    <a href="http://www.reddit.com/submit?url=http://localhost:4000/programming/2017/05/24/pandas-bar-plot-with-formatted-dates.html&title=Pandas & Matplotlib: personalize the date format in a bar chart" rel="nofollow" target="_blank" title="Share on Reddit" style='color: #FF4500;'>
    	<i class="fa fa-reddit fa-lg"></i>
    </a>
</div>



      </header>
      <hr style='border: 1px solid #fff;  border-top: 1px solid #EBEBEB;  border-bottom: 1px solid #fff;'/>
      <p>Yesterday, in the office, one of my colleague stumbled upon a problem that seemed really simple at first. He wanted to change the format of the dates on the x-axis in a simple bar chart with data read from a csv file. A really simple problem right? Well it happend that we spent quite some time in finding a simple and clean solution! We looked at several answers on Google and Stackoverflow, but nothing seemed to work. Finally I was able to came up with a solution that I will briefly explain here. (or you can look directly at this <a href="https://github.com/scentellegher/code_snippets/blob/master/bar_chart_formatted_dates/Bar_chart_with_formatted_dates.ipynb">[notebook]</a>)</p>

<p>For this purpose I downloaded the timeseries of the Game of Thrones Wikipedia page views during Season 7 from <a href="https://tools.wmflabs.org/pageviews/?project=en.wikipedia.org&amp;platform=all-access&amp;agent=user&amp;range=latest-20&amp;pages=Cat|Dog">[here]</a>.
At first I simply plotted a line chart using this code:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#import libraries
</span><span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="n">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="n">matplotlib.dates</span> <span class="k">as</span> <span class="n">mdates</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>

<span class="c1">#read data from csv
</span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_csv</span><span class="p">(</span><span class="sh">'</span><span class="s">data.csv</span><span class="sh">'</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">date</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">count</span><span class="sh">'</span><span class="p">],</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">date</span><span class="sh">'</span><span class="p">])</span>
<span class="c1">#set date as index
</span><span class="n">data</span><span class="p">.</span><span class="nf">set_index</span><span class="p">(</span><span class="sh">'</span><span class="s">date</span><span class="sh">'</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1">#plot data
</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
<span class="n">data</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>

<span class="c1">#set ticks every week
</span><span class="n">ax</span><span class="p">.</span><span class="n">xaxis</span><span class="p">.</span><span class="nf">set_major_locator</span><span class="p">(</span><span class="n">mdates</span><span class="p">.</span><span class="nc">WeekdayLocator</span><span class="p">())</span>
<span class="c1">#set major ticks format
</span><span class="n">ax</span><span class="p">.</span><span class="n">xaxis</span><span class="p">.</span><span class="nf">set_major_formatter</span><span class="p">(</span><span class="n">mdates</span><span class="p">.</span><span class="nc">DateFormatter</span><span class="p">(</span><span class="sh">'</span><span class="s">%b %d</span><span class="sh">'</span><span class="p">))</span>
</code></pre></div></div>

<div class="image-wrapper">
    
        <img src="/assets/images/post/2017_05_24_line_plot.png" width="" height="" alt="" />
    
    
        <p class="image-caption">Fig 1. Here you can see the number of page views of the Game of Thrones Wikipedia page. We can clearly see the peaks in the proximity of each episodes!</p>
    
</div>

<p>As you can see everything seems fine, the labels on the x-axis are well formatted with a label every week. What if we want to plot a bar chart instead? We can try to use the option <strong>kind=’bar’</strong> in the pandas <em>plot()</em> function</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="sh">'</span><span class="s">bar</span><span class="sh">'</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</code></pre></div></div>

<p>When we run the code again, we have the following error:</p>

<blockquote>
  <p><strong>ValueError: DateFormatter found a value of x=0, which is an illegal date.  This usually occurs because you have not informed the axis that it is plotting dates, e.g., with ax.xaxis_date()</strong></p>
</blockquote>

<p>and adding <strong>ax.xaxis_date()</strong> as suggested does not solve the problem! I tried to make the code work with the pandas <em>plot()</em> function but I couldn’t find a solution. So after spending some time looking around, I decided to give up and started to use the matplotlib <em>bar()</em> function</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ax</span><span class="p">.</span><span class="nf">bar</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">index</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="sh">'</span><span class="s">count</span><span class="sh">'</span><span class="p">])</span>
</code></pre></div></div>
<p>This is what we have</p>

<div class="image-wrapper">
    
        <img src="/assets/images/post/2017_05_24_wrong_bar_plot.png" width="" height="" alt="" />
    
    
        <p class="image-caption">Fig 2. We need to fix the date format!</p>
    
</div>

<p>The date labels formatted in this way are ugly! So let’s use the matplotlib <strong>DateFormatter</strong> to make them prettier…</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#set ticks every week
</span><span class="n">ax</span><span class="p">.</span><span class="n">xaxis</span><span class="p">.</span><span class="nf">set_major_locator</span><span class="p">(</span><span class="n">mdates</span><span class="p">.</span><span class="nc">WeekdayLocator</span><span class="p">())</span>
<span class="c1">#set major ticks format
</span><span class="n">ax</span><span class="p">.</span><span class="n">xaxis</span><span class="p">.</span><span class="nf">set_major_formatter</span><span class="p">(</span><span class="n">mdates</span><span class="p">.</span><span class="nc">DateFormatter</span><span class="p">(</span><span class="sh">'</span><span class="s">%b %d</span><span class="sh">'</span><span class="p">))</span>
</code></pre></div></div>

<div class="image-wrapper">
    
        <img src="/assets/images/post/2017_05_24_bar_plot.png" width="" height="" alt="" />
    
    
        <p class="image-caption">Fig 3. Finally!</p>
    
</div>

<p>… and that’s it! I hope this would help! Here you can find the code and the data that generated the plot in Fig 3. <a href="https://github.com/scentellegher/code_snippets/blob/master/bar_chart_formatted_dates/Bar_chart_with_formatted_dates.ipynb">[link]</a></p>

<p>NOTE: If you are interseted in a short and clear way to understand the python visualization world with pandas and matplotlib here there is a great <a href="http://pbpython.com/effective-matplotlib.html">resource</a>.</p>


      <div class="page-footer">
        <!-- <div class="page-share">
          <a href="https://twitter.com/intent/tweet?text=Pandas & Matplotlib: personalize the date format in a bar chart&url=http://localhost:4000/programming/2017/05/24/pandas-bar-plot-with-formatted-dates.html" title="Share on Twitter" rel="nofollow" target="_blank">Twitter</a>
          <a href="https://facebook.com/sharer.php?u=http://localhost:4000/programming/2017/05/24/pandas-bar-plot-with-formatted-dates.html" title="Share on Facebook" rel="nofollow" target="_blank">Facebook</a>
          <a href="https://plus.google.com/share?url=http://localhost:4000/programming/2017/05/24/pandas-bar-plot-with-formatted-dates.html" title="Share on Google+" rel="nofollow" target="_blank">Google+</a>
        </div> -->
        <div class="page-tag">
          
            <a href="/tags#pandas" class="tag">&#35; pandas</a>
          
            <a href="/tags#matplotlib" class="tag">&#35; matplotlib</a>
          
            <a href="/tags#visualization" class="tag">&#35; visualization</a>
          
        </div>
      </div>
      <section class="comment-area">
  <div class="comment-wrapper">
    
  </div>
</section> <!-- End Comment Area -->

    </div> <!-- End Wrap Content -->
  </div> <!-- End Page Content -->
</article> <!-- End Article Page -->

</div>

  </div>

  
    <!-- taken from https://www.osano.com/cookieconsent/documentation/javascript-api/ -->
<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script>
<script>

  function deleteAllCookies() {
    var cookies = document.cookie.split(";");

    for (var i = 0; i < cookies.length; i++) {
        var cookie = cookies[i];
        var eqPos = cookie.indexOf("=");
        var name = eqPos > -1 ? cookie.substr(0, eqPos) : cookie;
        document.cookie = name + "=;expires=Thu, 01 Jan 1970 00:00:00 GMT";
    }
  }

  var loadGoogleAnalytics = function(){
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    ga('create', '', 'auto');
    ga('send', 'pageview');
  };
  

  var loadGoogleAnalytics4 = function(){
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.googletagmanager.com/gtag/js?id=G-THFZKM9PJZ','ga');
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-THFZKM9PJZ');
  };


  window.addEventListener("load", function(){
  	cookieconsent.initialise({
        type: 'info',
        theme: 'classic',
        revokable: true,
        palette: {
          "popup": { "background": "#252e39", "text": "#ffffff" },
          "button": { "background": "#56cbdb", "text": "#ffffff" },
        },
        content: content_ = {
          message: "This site uses cookies from Google to deliver its services, to personalise ads and to analyse traffic. Information about your use of this site is shared with Google. By using this site, you agree to its use of cookies. If you want to learn more or withdraw your consent please click on ",
                allow: 'Allow',
                link: "Read More",
                href: 'http://localhost:4000/cookie-policy.html',
                target: '_blank',
        },
        law: {
          regionalLaw: false,
      	},
      
      onPopupOpen: function () {
        console.log("popup opened");
        console.log("#######"+window.location.pathname);
        // show shaded div
        if(window.location.pathname != '/cookie-policy.html'){
          var div = document.createElement('div');
          div.setAttribute("id", "shade-region");
          div.style.position = 'fixed';
          div.style.width = '100%';
          div.style.height = '100%';
          div.style.top = 0;
          div.style.opacity = 0.7;
          div.style.background = '#000';
          document.body.appendChild(div);
        }
      },

      onPopupClose: function () {
        if(window.location.pathname != '/cookie-policy.html'){
          var element = document.getElementById("shade-region");
          element.parentNode.removeChild(element);
          console.log("popup closed");
        }
      },
      
      onInitialise: function (status) {
        if(this.hasConsented()){
          console.log("Consented! Load analytics");
          loadGoogleAnalytics4();
        }
      },

  		onStatusChange: function(status, chosenBefore) {
    			if(this.hasConsented()){
            console.log("Consented! Enable analytics");
            window['ga-disable-'] = false;
      			loadGoogleAnalytics4();
      		} else {
            console.log("Denied! Disable and delete analytics");
            window['ga-disable-'] = true;
            deleteAllCookies()
      		}
  		}

	}); 
  });

</script>
  
  
</body>
</html>
