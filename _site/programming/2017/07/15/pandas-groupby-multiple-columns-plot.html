<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Pandas: plot the values of a groupby on multiple columns - Simone Centellegher, PhD - Data scientist and Researcher</title>

  <!-- Edit site and author settings in `_config.yml` to make the social details your own -->

    <meta content="Simone Centellegher, PhD - Data scientist and Researcher" property="og:site_name">
  
    <meta content="Pandas: plot the values of a groupby on multiple columns" property="og:title">
  
  
    <meta content="article" property="og:type">
  
  
    <meta content="Data Scientist and Researcher @ Fondazione Bruno Kessler (Italy)
" property="og:description">
  
  
    <meta content="http://localhost:4000/programming/2017/07/15/pandas-groupby-multiple-columns-plot.html" property="og:url">
  
  
    <meta content="2017-07-15T02:00:00+02:00" property="article:published_time">
    <meta content="http://localhost:4000/about/" property="article:author">
  
  
    <meta content="http://localhost:4000/assets/img/avatar.jpg" property="og:image">
  
  
    
    <meta content="programming" property="article:section">
    
  
  
    
    <meta content="pandas" property="article:tag">
    
    <meta content="groupby" property="article:tag">
    
    <meta content="programming" property="article:tag">
    
  

    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@">
    <meta name="twitter:creator" content="@simonecent">
  
    <meta name="twitter:title" content="Pandas: plot the values of a groupby on multiple columns">
  
  
    <meta name="twitter:url" content="http://localhost:4000/programming/2017/07/15/pandas-groupby-multiple-columns-plot.html">
  
  
    <meta name="twitter:description" content="Data Scientist and Researcher @ Fondazione Bruno Kessler (Italy)
">
  
  
    <meta name="twitter:image:src" content="http://localhost:4000/assets/img/avatar.jpg">
  

	<meta name="description" content="">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="initial-scale=1, maximum-scale=1">
	<meta property="og:image" content="">
	<link rel="shortcut icon" href="/assets/img/favicon/favicon.ico" type="image/x-icon">
	<link rel="apple-touch-icon" href="/assets/img/favicon/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicon/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicon/apple-touch-icon-144x144.png">
	<!-- Chrome, Firefox OS and Opera -->
	<meta name="theme-color" content="#263959">
	<!-- Windows Phone -->
	<meta name="msapplication-navbutton-color" content="#263959">
	<!-- iOS Safari -->
	<meta name="apple-mobile-web-app-status-bar-style" content="#263959">
	<!-- Google Fonts -->
	<link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,600" rel="stylesheet">
	<!-- Font Awesome -->
	<link rel="stylesheet" href="/assets/fonts/font-awesome/css/font-awesome.min.css">
	<!-- Styles -->
	<link rel="stylesheet" href="/assets/css/main.css">
  <!-- MathJax -->
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

  <!-- Cookie banner -->
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css" />
  <!-- Site verification -->
  <meta name="google-site-verification" content="sZB103JolPNU6L9ptJEZyy-OLhykJGu3zKyjQb7FVuo" />

</head>

<body>

  <div class="wrapper">
    <aside class="sidebar">
  <header>
    <div class="about">
      <div class="cover-author-image">
        <a href="/"><img src="/assets/images/avatar.jpg" alt="Simone Centellegher"></a>
      </div>
      <div class="author-name">Simone Centellegher</div>
      <p>Data scientist and Researcher in the Mobile and Social Computing Lab @ Fondazione Bruno Kessler (Trento, Italy).  I study human behaviour from data generated by mobile phones, social media and credit card transactions.</p>
    </div>
    <div class="bmc">
      <a href='https://ko-fi.com/Y8Y2LIWPU' target='_blank'><img height='36' style='border:0px;height:36px;' src='https://storage.ko-fi.com/cdn/kofi4.png?v=3' border='0' alt='Buy Me a Coffee at ko-fi.com' /></a>
    </div>
  </header> <!-- End Header -->
  <!-- <div class="navigation">
    <ul>
      
        <li><a style='font-weight: 300;' href="/categories/research">research</a></li>
      
        <li><a style='font-weight: 300;' href="/categories/programming">programming</a></li>
      
        <li><a style='font-weight: 300;' href="/categories/visualization">visualization</a></li>
      
        <li><a style='font-weight: 300;' href="/categories/machine-learning">machine-learning</a></li>
      
    </ul>
  </div>  -->

    


  <footer>
    <section class="contact">
      <h3 class="contact-title">Contact me</h3>
      <ul>
        
          <li><a id='twitter' href="https://twitter.com/simonecent" target="_blank"><i class="fa fa-twitter" aria-hidden="true"></i></a></li>
        
        <!-- 
          <li><a href="https://facebook.com/" target="_blank"><i class="fa fa-facebook" aria-hidden="true"></i></a></li>
         -->
        
          <li class="github"><a id='github' href="http://github.com/scentellegher" target="_blank"><i class="fa fa-github"></i></a></li>
        
        
          <li class="linkedin"><a id='linkedin' href="https://in.linkedin.com/in/scentellegher" target="_blank"><i class="fa fa-linkedin"></i></a></li>
        
        <!-- 
          <li class="email"><a href="mailto:example.david@blog.com"><i class="fa fa-envelope-o" aria-hidden="true"></i></a></li>
         -->
        <li><a id='cv' href="/assets/cv/simone_centellegher_cv.pdf" target="_blank"><i class="fa fa-file-text-o"></i></a></li>
        <li class="scholar"><a id='scholar' href="https://scholar.google.it/citations?user=-W9l1PFnP6gC&hl=en" target="_blank"><i class="fa fa-google"></i></a></li>
      </ul>
    </section> <!-- End Section Contact -->
    <div class="copyright">
      <p>2023 &copy; Simone Centellegher</p>
    </div>
  </footer> <!-- End Footer -->
</aside> <!-- End Sidebar -->
<div class="content-box clearfix">
  <article class="article-page">
  <div class="page-content">
    
    
    <div class="wrap-content">
      <header class="header-page">
        <h1 class="page-title">Pandas: plot the values of a groupby on multiple columns</h1>
        <div class="page-date"><span>2017, Jul 15&nbsp;&nbsp;&nbsp;&nbsp;</span></div>
        <div class="share-page">
    Share this on &rarr;
    <a href="https://twitter.com/intent/tweet?text=Pandas: plot the values of a groupby on multiple columns&url=http://localhost:4000/programming/2017/07/15/pandas-groupby-multiple-columns-plot.html&via=&related=" rel="nofollow" target="_blank" title="Share on Twitter" style="color:  #1DA1F2;">
    	<i class="fa fa-twitter fa-lg"></i>
    </a>
    <a href="https://www.facebook.com/sharer.php?u=http://localhost:4000//programming/2017/07/15/pandas-groupby-multiple-columns-plot.html&title=Pandas: plot the values of a groupby on multiple columns" rel="nofollow" target="_blank" title="Share on Facebook" style='color: #4867AA;'>
    	<i class="fa fa-facebook fa-lg"></i>
    </a>
    <!-- <a href="https://plus.google.com/share?url=http://localhost:4000/programming/2017/07/15/pandas-groupby-multiple-columns-plot.html" rel="nofollow" target="_blank" title="Share on Google+" style='color: #DD4B39;'>
    	<i class="fa fa-google-plus fa-lg"></i>
    </a> -->
    <a href="http://www.linkedin.com/shareArticle?mini=true&url=http://localhost:4000/programming/2017/07/15/pandas-groupby-multiple-columns-plot.html&title=Pandas: plot the values of a groupby on multiple columns" target="_blank" title="Share on LinkedIn" style='color: #0177B5;'>
    	<i class="fa fa-linkedin fa-lg"></i>
    </a>
    <a href="http://www.reddit.com/submit?url=http://localhost:4000/programming/2017/07/15/pandas-groupby-multiple-columns-plot.html&title=Pandas: plot the values of a groupby on multiple columns" rel="nofollow" target="_blank" title="Share on Reddit" style='color: #FF4500;'>
    	<i class="fa fa-reddit fa-lg"></i>
    </a>
</div>



      </header>
      <hr style='border: 1px solid #fff;  border-top: 1px solid #EBEBEB;  border-bottom: 1px solid #fff;'/>
      <p>This is just a pandas programming note that explains how to plot in a fast way different categories contained in a groupby on multiple columns, generating a two level MultiIndex.</p>

<p>Suppose you have a dataset containing credit card transactions, including:</p>
<ul>
  <li>the date of the transaction</li>
  <li>the credit card number</li>
  <li>the type of the expense</li>
  <li>the amount of the transaction</li>
</ul>

<p>Since this kind of data it is not freely available for privacy reasons, I generated a fake dataset using the python library <a href="https://github.com/joke2k/faker">Faker</a>, that generates fake data for you. In Fig 1. you can see such generated data.</p>

<div class="image-wrapper">
    
        <img src="/assets/images/post/2017_07_15_data_unstack.png" width="350" height="auto" alt="" />
    
    
        <p class="image-caption">Fig 1. Data generated with the python module Faker.</p>
    
</div>

<p>Now suppose we would like to see the daily number of transactions made for each expense type. How can we do that? Well it is pretty simple, we just need to use the <strong>groupby()</strong> method, grouping the data by <em>date</em> and <em>type</em> and then plot it!</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#plot data
</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
<span class="n">data</span><span class="p">.</span><span class="nf">groupby</span><span class="p">([</span><span class="sh">'</span><span class="s">date</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">type</span><span class="sh">'</span><span class="p">]).</span><span class="nf">count</span><span class="p">()[</span><span class="sh">'</span><span class="s">amount</span><span class="sh">'</span><span class="p">].</span><span class="nf">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</code></pre></div></div>

<p>Let’s see the result!</p>

<div class="image-wrapper">
    
        <img src="/assets/images/post/2017_07_15_plot_without_unstack.jpeg" width="" height="" alt="" />
    
    
        <p class="image-caption">Fig 2. Uhm.. there is something wrong..</p>
    
</div>

<p>What happend here? We have just one line! This probably means that there is something wrong in how the data is represented in our dataframe..<br />
In Fig 3. (left), we have an excerpt of our dataframe after we apply the <em>groupby()</em> to the data. As we can see, the daily category are correctly grouped, but we do not have a series of value for each expense type!<br />
 How can we do that? We can use the <em>unstack()</em> method (<a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.unstack.html">doc</a>).<br />
 What this function does is basically pivoting a level of the row index (in this case the type of the expense) to the column axis as shown in Fig 3. (right).</p>

<div class="image-wrapper">
    
        <img src="/assets/images/post/2017_07_15_vs_unstack.png" width="" height="" alt="" />
    
    
        <p class="image-caption">Fig 3. Our grouped data before (left) and after applying the unstack() method (right)</p>
    
</div>

<p>If you want to understand more about stacking, unstacking and pivoting tables with Pandas, give a look at this nice explanation given by Nikolay Grozev in his <a href="http://nikgrozev.com/2015/07/01/reshaping-in-pandas-pivot-pivot-table-stack-and-unstack-explained-with-pictures/">post</a>.
Now since our data is correctly represented, we can finally plot the daily number of transactions made for each expense type:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># plot data
</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
<span class="c1"># use unstack()
</span><span class="n">data</span><span class="p">.</span><span class="nf">groupby</span><span class="p">([</span><span class="sh">'</span><span class="s">date</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">type</span><span class="sh">'</span><span class="p">]).</span><span class="nf">count</span><span class="p">()[</span><span class="sh">'</span><span class="s">amount</span><span class="sh">'</span><span class="p">].</span><span class="nf">unstack</span><span class="p">().</span><span class="nf">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</code></pre></div></div>

<div class="image-wrapper">
    
        <img src="/assets/images/post/2017_07_15_plot_with_unstack.png" width="" height="" alt="" />
    
    
        <p class="image-caption">Fig 4. Our final plot!</p>
    
</div>

<p>You can see the complete code in this <a href="https://github.com/scentellegher/code_snippets/blob/master/pandas_groupby_unstack/Plot_groupby_multiple_columns_unstack.ipynb">[notebook]</a></p>


      <div class="page-footer">
        <!-- <div class="page-share">
          <a href="https://twitter.com/intent/tweet?text=Pandas: plot the values of a groupby on multiple columns&url=http://localhost:4000/programming/2017/07/15/pandas-groupby-multiple-columns-plot.html" title="Share on Twitter" rel="nofollow" target="_blank">Twitter</a>
          <a href="https://facebook.com/sharer.php?u=http://localhost:4000/programming/2017/07/15/pandas-groupby-multiple-columns-plot.html" title="Share on Facebook" rel="nofollow" target="_blank">Facebook</a>
          <a href="https://plus.google.com/share?url=http://localhost:4000/programming/2017/07/15/pandas-groupby-multiple-columns-plot.html" title="Share on Google+" rel="nofollow" target="_blank">Google+</a>
        </div> -->
        <div class="page-tag">
          
            <a href="/tags#pandas" class="tag">&#35; pandas</a>
          
            <a href="/tags#groupby" class="tag">&#35; groupby</a>
          
            <a href="/tags#programming" class="tag">&#35; programming</a>
          
        </div>
      </div>
      <section class="comment-area">
  <div class="comment-wrapper">
    
  </div>
</section> <!-- End Comment Area -->

    </div> <!-- End Wrap Content -->
  </div> <!-- End Page Content -->
</article> <!-- End Article Page -->

</div>

  </div>

  
    <!-- taken from https://www.osano.com/cookieconsent/documentation/javascript-api/ -->
<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script>
<script>

  function deleteAllCookies() {
    var cookies = document.cookie.split(";");

    for (var i = 0; i < cookies.length; i++) {
        var cookie = cookies[i];
        var eqPos = cookie.indexOf("=");
        var name = eqPos > -1 ? cookie.substr(0, eqPos) : cookie;
        document.cookie = name + "=;expires=Thu, 01 Jan 1970 00:00:00 GMT";
    }
  }

  var loadGoogleAnalytics = function(){
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    ga('create', '', 'auto');
    ga('send', 'pageview');
  };
  

  var loadGoogleAnalytics4 = function(){
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.googletagmanager.com/gtag/js?id=G-THFZKM9PJZ','ga');
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-THFZKM9PJZ');
  };


  window.addEventListener("load", function(){
  	cookieconsent.initialise({
        type: 'info',
        theme: 'classic',
        revokable: true,
        palette: {
          "popup": { "background": "#252e39", "text": "#ffffff" },
          "button": { "background": "#56cbdb", "text": "#ffffff" },
        },
        content: content_ = {
          message: "This site uses cookies from Google to deliver its services, to personalise ads and to analyse traffic. Information about your use of this site is shared with Google. By using this site, you agree to its use of cookies. If you want to learn more or withdraw your consent please click on ",
                allow: 'Allow',
                link: "Read More",
                href: 'http://localhost:4000/cookie-policy.html',
                target: '_blank',
        },
        law: {
          regionalLaw: false,
      	},
      
      onPopupOpen: function () {
        console.log("popup opened");
        console.log("#######"+window.location.pathname);
        // show shaded div
        if(window.location.pathname != '/cookie-policy.html'){
          var div = document.createElement('div');
          div.setAttribute("id", "shade-region");
          div.style.position = 'fixed';
          div.style.width = '100%';
          div.style.height = '100%';
          div.style.top = 0;
          div.style.opacity = 0.7;
          div.style.background = '#000';
          document.body.appendChild(div);
        }
      },

      onPopupClose: function () {
        if(window.location.pathname != '/cookie-policy.html'){
          var element = document.getElementById("shade-region");
          element.parentNode.removeChild(element);
          console.log("popup closed");
        }
      },
      
      onInitialise: function (status) {
        if(this.hasConsented()){
          console.log("Consented! Load analytics");
          loadGoogleAnalytics4();
        }
      },

  		onStatusChange: function(status, chosenBefore) {
    			if(this.hasConsented()){
            console.log("Consented! Enable analytics");
            window['ga-disable-'] = false;
      			loadGoogleAnalytics4();
      		} else {
            console.log("Denied! Disable and delete analytics");
            window['ga-disable-'] = true;
            deleteAllCookies()
      		}
  		}

	}); 
  });

</script>
  
  
</body>
</html>
